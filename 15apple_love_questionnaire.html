<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒè‹¹æœçš„å°ç§˜å¯†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'midnight': '#0f0f23',
                        'cosmic': '#1a1a2e',
                        'nebula': '#16213e',
                        'aurora': '#e91e63',
                        'rose-glow': '#ff6b9d',
                        'pink-dream': '#ffeaa7'
                    },
                    fontFamily: {
                        'elegant': ['Inter', 'system-ui', 'sans-serif'],
                        'script': ['Dancing Script', 'cursive'],
                        'chinese': ['Ma Shan Zheng', 'serif'],
                        'handwrite': ['Kalam', 'cursive'],
                        'serif': ['Noto Serif SC', 'serif'],
                        'calligraphy': ['Source Han Serif SC', 'Noto Serif SC', 'serif'],
                        'vintage': ['Zhi Mang Xing', 'cursive'],
                    },
                    backgroundImage: {
                        'cosmic-gradient': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'aurora-gradient': 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                        'dream-gradient': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Ma+Shan+Zheng&family=Kalam:wght@400;700&family=Noto+Serif+SC:wght@400;500;600;700&family=Source+Han+Serif+SC:wght@400;500;600;700&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        @keyframes fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(233, 30, 99, 0.3), 
                           0 0 60px rgba(233, 30, 99, 0.1),
                           inset 0 1px 0 rgba(255, 255, 255, 0.1); 
            }
            50% { 
                box-shadow: 0 0 40px rgba(233, 30, 99, 0.5), 
                           0 0 80px rgba(233, 30, 99, 0.2),
                           inset 0 1px 0 rgba(255, 255, 255, 0.2); 
            }
        }
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(233, 30, 99, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(233, 30, 99, 0.7);
                transform: scale(1.05);
            }
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .floating { animation: float 4s ease-in-out infinite; }
        .falling { animation: fall 10s linear infinite; }
        .glow-effect { animation: glow 3s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .glass-button {
            background: linear-gradient(145deg, rgba(233, 30, 99, 0.8), rgba(245, 87, 108, 0.6));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(233, 30, 99, 0.3);
        }
        
        .shimmer-effect {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .cosmic-bg {
            background: radial-gradient(ellipse at top, #1a1a2e 0%, #0f0f23 100%);
            position: relative;
        }
        
        .cosmic-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(233, 30, 99, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(245, 87, 108, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 60% 20%, rgba(255, 107, 157, 0.05) 0%, transparent 50%);
        }
    </style>
</head>
<body class="font-elegant cosmic-bg min-h-screen overflow-hidden relative">
    
    <!-- é¢„è§ˆæ¡†æ¶ -->
    <div class="hidden fixed top-4 left-4 right-4 z-50 glass-card rounded-2xl p-6" id="preview-mode">
        <div class="text-white font-medium mb-4 font-serif">é¡µé¢é¢„è§ˆæ¨¡å¼</div>
        <div class="flex space-x-4 overflow-x-auto">
            <div class="flex-shrink-0 w-52 h-36 glass-card rounded-xl p-4 cursor-pointer hover:border-aurora/50 transition-all group" onclick="showPage('cover')">
                <div class="text-sm text-pink-300 font-medium mb-2 font-serif">å°é¢é¡µ</div>
                <div class="text-center text-2xl group-hover:scale-110 transition-transform">ğŸ</div>
                <div class="text-xs text-gray-400 mt-2 font-serif">æƒ…æ„Ÿå¼•å…¥</div>
            </div>
            <div class="flex-shrink-0 w-52 h-36 glass-card rounded-xl p-4 cursor-pointer hover:border-aurora/50 transition-all group" onclick="showPage('input')">
                <div class="text-sm text-pink-300 font-medium mb-2 font-serif">è¾“å…¥é¡µ</div>
                <div class="text-center text-2xl group-hover:scale-110 transition-transform">ğŸ‘¤</div>
                <div class="text-xs text-gray-400 mt-2 font-serif">ä¸ªæ€§åŒ–è®¾ç½®</div>
            </div>
            <div class="flex-shrink-0 w-52 h-36 glass-card rounded-xl p-4 cursor-pointer hover:border-aurora/50 transition-all group" onclick="showPage('quiz')">
                <div class="text-sm text-pink-300 font-medium mb-2 font-serif">é—®å·é¡µ</div>
                <div class="text-center text-2xl group-hover:scale-110 transition-transform">ğŸ“</div>
                <div class="text-xs text-gray-400 mt-2 font-serif">æƒ…æ„ŸæŒ–æ˜</div>
            </div>
            <div class="flex-shrink-0 w-52 h-36 glass-card rounded-xl p-4 cursor-pointer hover:border-aurora/50 transition-all group" onclick="showPage('result')">
                <div class="text-sm text-pink-300 font-medium mb-2 font-serif">æƒ…ä¹¦é¡µ</div>
                <div class="text-center text-2xl group-hover:scale-110 transition-transform">ğŸ’Œ</div>
                <div class="text-xs text-gray-400 mt-2 font-serif">æƒ…æ„Ÿè¾“å‡º</div>
            </div>
        </div>
        <button onclick="togglePreview()" class="mt-4 px-6 py-2 glass-button text-white rounded-xl font-medium hover:scale-105 transition-all font-serif">
            é€€å‡ºé¢„è§ˆ
        </button>
    </div>

    <!-- é£˜è½åŠ¨ç”»èƒŒæ™¯ -->
    <div class="fixed inset-0 pointer-events-none z-10" id="animation-bg">
        <!-- çˆ±å¿ƒé£˜è½ -->
        <div class="absolute top-0 left-[5%] text-aurora text-xl falling opacity-60" style="animation-delay: 0s;">ğŸ’•</div>
        <div class="absolute top-0 left-[25%] text-rose-glow text-lg falling opacity-70" style="animation-delay: 1s;">ğŸ’–</div>
        <div class="absolute top-0 left-[45%] text-pink-dream text-xl falling opacity-50" style="animation-delay: 2s;">ğŸ’—</div>
        <div class="absolute top-0 left-[65%] text-aurora text-lg falling opacity-80" style="animation-delay: 3s;">ğŸ’</div>
        <div class="absolute top-0 left-[85%] text-rose-glow text-xl falling opacity-60" style="animation-delay: 4s;">ğŸ’•</div>
        
        <!-- æ¨±èŠ±é£˜è½ -->
        <div class="absolute top-0 left-[15%] text-pink-300 text-lg falling opacity-60" style="animation-delay: 0.5s;">ğŸŒ¸</div>
        <div class="absolute top-0 left-[35%] text-pink-200 text-xl falling opacity-50" style="animation-delay: 1.5s;">ğŸŒ¸</div>
        <div class="absolute top-0 left-[55%] text-rose-200 text-lg falling opacity-70" style="animation-delay: 2.5s;">ğŸŒ¸</div>
        <div class="absolute top-0 left-[75%] text-pink-300 text-xl falling opacity-40" style="animation-delay: 3.5s;">ğŸŒ¸</div>
        <div class="absolute top-0 left-[95%] text-pink-200 text-lg falling opacity-60" style="animation-delay: 4.5s;">ğŸŒ¸</div>
    </div>

    <!-- å°é¢é¡µ -->
    <div id="cover-page" class="flex items-center justify-center min-h-screen p-8 cursor-pointer relative z-20" onclick="nextPage()">
        <div class="text-center space-y-10 max-w-lg mx-auto">
            <!-- è‹¹æœå›¾æ ‡ -->
            <div class="text-8xl floating filter drop-shadow-2xl">ğŸ</div>
            
            <!-- ä¸»æ–‡æ¡ˆ -->
            <div class="glass-card rounded-3xl p-10 space-y-8 relative overflow-hidden">
                <!-- è£…é¥°æ€§é—ªå…‰æ•ˆæœ -->
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-aurora to-transparent shimmer-effect"></div>
                
                <div class="space-y-6">
                    <h1 class="text-3xl font-script gradient-text font-bold">
                        "åƒè‹¹æœ"çš„å°ç§˜å¯†
                    </h1>
                    <p class="text-gray-200 text-lg leading-relaxed font-serif font-light">
                        æ˜¯åªæœ‰ä½ å’Œä»–çŸ¥é“çš„äº²å¯†æš—å·
                    </p>
                    <div class="w-16 h-px bg-gradient-to-r from-aurora to-rose-glow mx-auto"></div>
                    <p class="text-gray-300 text-base leading-relaxed font-serif">
                        æ¥å§ï¼Œæ‹¿èµ·è¿™ä»½é—®å·<br>
                        <span class="gradient-text font-medium">ä¸€èµ·å“å°å¿«ä¹</span>
                    </p>
                </div>
                
                <!-- ç‚¹å‡»æç¤º -->
                <div class="pt-6">
                    <div class="inline-flex items-center space-x-3 px-8 py-4 glass-card rounded-full glow-effect group">
                        <span class="text-white font-medium font-serif">ç‚¹å‡»ä»»æ„ä½ç½®å¼€å§‹</span>
                        <div class="w-2 h-2 bg-aurora rounded-full animate-pulse"></div>
                    </div>
                </div>
            </div>
            
            <!-- åº•éƒ¨è£…é¥° -->
            <div class="flex justify-center space-x-4 opacity-40">
                <div class="text-pink-300 text-sm">ğŸ’•</div>
                <div class="text-rose-300 text-sm">ğŸ’–</div>
                <div class="text-aurora text-sm">ğŸ’—</div>
            </div>
        </div>
    </div>

    <!-- è¾“å…¥é¡µ -->
    <div id="input-page" class="hidden min-h-screen p-8 flex flex-col justify-center relative z-20">
        <!-- é¡¶éƒ¨å¤´åƒåŒºåŸŸï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ -->
        <div id="avatar-area" class="fixed top-8 left-1/2 transform -translate-x-1/2 hidden z-30">
            <div class="w-36 h-36 overflow-hidden glass-card p-1 glow-effect">
                <img id="uploaded-avatar" class="w-full h-full object-cover" src="" alt="å¤´åƒ">
            </div>
        </div>

        <div class="max-w-lg mx-auto space-y-10 mt-44">
            <!-- æ ‡é¢˜ -->
            <div class="text-center space-y-4">
                <h2 class="text-4xl font-script gradient-text font-bold">å¼€å§‹æˆ‘ä»¬çš„ç§˜å¯†</h2>
                <p class="text-gray-300 text-lg font-serif font-light">è®©æˆ‘æ›´äº†è§£é‚£ä¸ªç‰¹åˆ«çš„ta</p>
                <div class="w-20 h-px bg-gradient-to-r from-aurora to-rose-glow mx-auto"></div>
            </div>

            <!-- è¾“å…¥è¡¨å• -->
            <div class="space-y-8">
                <!-- å§“åè¾“å…¥ -->
                <div class="glass-card rounded-2xl p-8 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-aurora/50 to-transparent"></div>
                    <label class="block text-gray-200 font-medium mb-4 flex items-center space-x-2 font-serif">
                        <span>ğŸ‘¤</span>
                        <span>è¯·è¾“å…¥mjgçš„åå­—</span>
                    </label>
                    <input 
                        type="text" 
                        id="userName" 
                        placeholder="taçš„åå­—..."
                        autocomplete="off"
                        class="w-full bg-black/30 border border-white/10 rounded-xl px-6 py-4 text-white placeholder-gray-400 focus:border-aurora focus:outline-none focus:ring-2 focus:ring-aurora/20 transition-all font-serif text-lg backdrop-blur-sm"
                    >
                </div>

                <!-- å›¾ç‰‡ä¸Šä¼  -->
                <div class="glass-card rounded-2xl p-8 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-rose-glow/50 to-transparent"></div>
                    <label class="block text-gray-200 font-medium mb-4 flex items-center space-x-2 font-serif">
                        <span>ğŸ“·</span>
                        <span>ä¸Šä¼ mjgçš„ç…§ç‰‡</span>
                    </label>
                    <div class="relative">
                        <input 
                            type="file" 
                            id="userPhoto" 
                            accept="image/*"
                            class="hidden"
                            onchange="handleImageUpload(this)"
                        >
                        <label 
                            for="userPhoto"
                            class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-white/20 rounded-xl cursor-pointer hover:border-aurora/50 transition-all group glass-card"
                        >
                            <div class="text-aurora text-5xl mb-3 group-hover:scale-110 transition-transform">ğŸ“¸</div>
                            <span class="text-gray-300 font-medium font-serif">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</span>
                            <span class="text-gray-500 text-sm mt-1 font-serif">æ”¯æŒ JPGã€PNG æ ¼å¼</span>
                        </label>
                    </div>
                </div>

                <!-- å¼€å§‹æŒ‰é’® -->
                <button 
                    id="start-quiz-btn"
                    onclick="startQuiz()"
                    disabled
                    class="w-full glass-button text-white py-5 rounded-xl font-semibold text-xl disabled:opacity-50 disabled:cursor-not-allowed hover:scale-[1.02] transition-all relative overflow-hidden group font-serif"
                >
                    <span class="relative z-10">å¼€å§‹å¿ƒåŠ¨é—®å·</span>
                    <div class="absolute inset-0 bg-gradient-to-r from-aurora to-rose-glow opacity-0 group-hover:opacity-20 transition-opacity"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- é—®å·é¡µ -->
    <div id="quiz-page" class="hidden min-h-screen relative z-20">
        <!-- é¡¶éƒ¨å¤´åƒï¼ˆå›ºå®šæ˜¾ç¤ºï¼‰ -->
        <div id="quiz-avatar" class="fixed top-6 left-1/2 transform -translate-x-1/2 z-30">
            <div class="w-36 h-36 overflow-hidden glass-card p-1">
                <img id="quiz-avatar-img" class="w-full h-full object-cover" src="" alt="å¤´åƒ">
            </div>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="fixed top-44 left-1/2 transform -translate-x-1/2 w-80 max-w-[90vw] z-30">
            <div class="glass-card rounded-full p-2">
                <div class="flex items-center justify-between text-sm text-gray-300 mb-2 font-serif">
                    <span id="current-question">1</span>
                    <span class="gradient-text font-medium font-chinese">å¿ƒåŠ¨é—®å·</span>
                    <span>/ 25</span>
                </div>
                <div class="w-full bg-black/30 rounded-full h-2">
                    <div id="progress-bar" class="bg-gradient-to-r from-aurora to-rose-glow h-2 rounded-full transition-all duration-500" style="width: 4%"></div>
                </div>
            </div>
        </div>

        <!-- é—®é¢˜å†…å®¹åŒº -->
        <div class="pt-60 pb-20 px-6 max-w-2xl mx-auto">
            <div id="question-container" class="space-y-8">
                <!-- é—®é¢˜å¡ç‰‡ -->
                <div class="glass-card rounded-3xl p-8 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-aurora/50 to-transparent"></div>
                    
                    <!-- é—®é¢˜æ–‡æœ¬ -->
                    <h3 id="question-text" class="text-2xl font-chinese text-gray-100 leading-relaxed mb-8 text-left">
                        <!-- åŠ¨æ€é—®é¢˜å†…å®¹ -->
                    </h3>

                    <!-- é€‰é¡¹åˆ—è¡¨ -->
                    <div id="options-container" class="space-y-4 mb-8">
                        <!-- åŠ¨æ€é€‰é¡¹å†…å®¹ -->
                    </div>

                    <!-- ä¸“å±ç­”æ¡ˆè¾“å…¥æ¡† -->
                    <div class="glass-card rounded-2xl p-6 border-dashed border-white/20">
                        <label class="block text-gray-300 font-medium mb-3 flex items-center space-x-2 font-serif">
                            <span>âœ¨</span>
                            <span>ä½ çš„ä¸“å±ç­”æ¡ˆ</span>
                        </label>
                        <textarea 
                            id="custom-answer"
                            placeholder="å†™ä¸‹åªå±äºä½ ä»¬çš„ç­”æ¡ˆ..."
                            class="w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:border-aurora focus:outline-none focus:ring-2 focus:ring-aurora/20 transition-all resize-none h-20 font-serif"
                            oninput="toggleNextButton()"
                        ></textarea>
                        
                        <!-- ä¸‹ä¸€é¢˜æŒ‰é’® -->
                        <button 
                            id="next-question-btn"
                            onclick="nextQuestionFromCustom()"
                            class="hidden w-full mt-4 glass-button text-white py-3 rounded-xl font-medium hover:scale-[1.02] transition-all glow-effect font-serif"
                        >
                            ä¸‹ä¸€é¢˜ â†’
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- éŸ³ä¹æ§åˆ¶ -->
        <div class="fixed bottom-6 left-6 z-30">
            <button id="music-toggle" onclick="toggleMusic()" class="glass-card p-4 rounded-full hover:scale-105 transition-all">
                <span id="music-icon" class="text-2xl">ğŸµ</span>
            </button>
        </div>
    </div>

    <!-- æƒ…ä¹¦ç”Ÿæˆé¡µ -->
    <div id="result-page" class="hidden min-h-screen relative z-20 p-4 flex items-center justify-center transition-all duration-1000">
        <div class="max-w-4xl mx-auto w-full">
            <!-- ç½‘æ˜“äº‘é£æ ¼æƒ…ä¹¦å¡ç‰‡ -->
            <div id="love-letter-card" class="relative overflow-hidden shadow-2xl">
                <!-- ä¸»èƒŒæ™¯ -->
                <div class="absolute inset-0 bg-gradient-to-br from-cosmic via-nebula to-midnight opacity-90"></div>
                <!-- åŠ¨æ€é¢œè‰²èƒŒæ™¯å±‚ -->
                <div id="dynamic-bg" class="absolute inset-0 opacity-20 transition-all duration-1000"></div>
                
                <!-- ç»ç’ƒæ‹Ÿæ€å¡ç‰‡ -->
                <div class="relative glass-card rounded-3xl p-6 md:p-8 border-2 border-white/10 backdrop-blur-xl">
                    <!-- è£…é¥°æ€§å…‰æ•ˆ -->
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-aurora/70 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-rose-glow/50 to-transparent"></div>
                    
                    <!-- è§’è½è£…é¥° -->
                    <div class="absolute top-4 left-4 w-3 h-3 bg-aurora/30 rounded-full"></div>
                    <div class="absolute top-4 right-4 w-3 h-3 bg-rose-glow/30 rounded-full"></div>
                    <div class="absolute bottom-4 left-4 w-3 h-3 bg-pink-dream/30 rounded-full"></div>
                    <div class="absolute bottom-4 right-4 w-3 h-3 bg-aurora/30 rounded-full"></div>
                
                    <div class="flex flex-col lg:flex-row items-center space-y-8 lg:space-y-0 lg:space-x-8">
                        <!-- å·¦ä¾§ï¼šåœ†å½¢ç”»æ¡†å¤´åƒ -->
                        <div class="flex-shrink-0">
                            <div class="relative">
                                <!-- åœ†å½¢ç”»æ¡† -->
                                <div class="w-40 h-40 md:w-48 md:h-48 rounded-full relative overflow-hidden shadow-2xl border-4 border-white/20 glass-card">
                                    <!-- ç”¨æˆ·å¤´åƒå¡«æ»¡æ•´ä¸ªåœ†å½¢ -->
                                    <img id="result-avatar" class="w-full h-full object-cover" src="" alt="å¤´åƒ">
                                    
                                    <!-- ç”»æ¡†å†…ä¾§è£…é¥° -->
                                    <div class="absolute inset-0 rounded-full border-2 border-white/10"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å³ä¾§ï¼šæƒ…ä¹¦å†…å®¹ -->
                        <div class="flex-1 space-y-6 w-full">
                            <!-- æ ‡é¢˜ -->
                            <div class="space-y-3 text-center lg:text-left">
                                <h2 class="text-2xl md:text-3xl font-chinese gradient-text font-bold">ä½ å’Œ<span id="result-name"></span>çš„æµªæ¼«æƒ…è¯—</h2>
                                <p class="text-gray-300 text-sm font-serif font-light italic">åœ¨æ¯ä¸ªå¿ƒåŠ¨ç¬é—´ï¼Œè°±å†™ç€åªå±äºä½ ä»¬çš„çˆ±æƒ…è¯—ç¯‡</p>
                            </div>
                            
                            <!-- æƒ…ä¹¦å†…å®¹ -->
                            <div id="love-letter-content" class="space-y-4 text-gray-200 leading-relaxed font-serif text-base md:text-lg">
                                <!-- åŠ¨æ€ç”Ÿæˆçš„æƒ…ä¹¦å†…å®¹ -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="mt-8 flex flex-col sm:flex-row justify-center items-center space-y-3 sm:space-y-0 sm:space-x-4">
                        <button 
                            onclick="generateNewLetter()"
                            class="w-full sm:w-auto px-6 py-3 glass-card border border-white/20 text-white rounded-xl hover:border-aurora/50 transition-all font-medium font-serif"
                        >
                            ğŸ² é‡æ–°ç”Ÿæˆ
                        </button>
                        
                        <button 
                            onclick="restartQuiz()"
                            class="w-full sm:w-auto px-6 py-3 glass-card border border-white/20 text-white rounded-xl hover:border-rose-glow/50 transition-all font-medium font-serif"
                        >
                            ğŸ”„ é‡æ–°å¡«å†™
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¢„è§ˆæŒ‰é’® -->
    <button onclick="togglePreview()" class="fixed bottom-6 right-6 glass-button text-white px-6 py-3 rounded-xl font-medium hover:scale-105 transition-all z-40 shadow-lg font-serif">
        ğŸ” é¡µé¢é¢„è§ˆ
    </button>

    <script>
        let currentPage = 'cover';
        let userName = '';
        let userAvatar = '';
        let quizAnswers = [];
        let currentQuestionIndex = 0;
        let selectedOptions = []; // ç”¨äºå¤šé€‰é¢˜

        // é—®å·æ•°æ®
        const questions = [
            {
                id: 1,
                text: 'ä½ ä»¬"åƒè‹¹æœ"æ—¶ï¼Œæœ€å–œæ¬¢å“ªä¸ªåœ°ç‚¹ï¼Ÿ',
                options: [
                    'ä»–çš„åŠå…¬å®¤/ä¹¦æˆ¿',
                    'ç„å…³ç©¿è¡£é•œå‰', 
                    'å§å®¤å¤§åºŠ',
                    'å®¢å…æŸ”è½¯çš„æ¯›æ¯¯/æ²™å‘',
                    'åˆºæ¿€çš„å…¬å…±åœºæ‰€è¾¹ç¼˜ï¼ˆå¦‚åœ°ä¸‹è½¦åº“ã€å‡æœŸä½ ä»¬å­¦æ ¡çš„è¯¾æ¡Œä¸‹ï¼‰'
                ]
            },
            {
                id: 2,
                text: 'é€šå¸¸ï¼Œæ˜¯è°å…ˆæš—ç¤ºæƒ³"åƒè‹¹æœ"ï¼Ÿ',
                options: [
                    'ä»–ï¼ˆçœ¼ç¥å˜å¾—å¹½æ·±ï¼Œå¸¦ç€ä¸å®¹ç½®ç–‘ï¼‰',
                    'ä»–ï¼ˆç”¨æŒ‡å°–è‹¥æœ‰ä¼¼æ— åœ°åˆ’è¿‡ä½ çš„æ•æ„Ÿå¸¦ï¼Œå˜´è§’å™™ç€ç¬‘ï¼‰',
                    'ä»–ï¼ˆä»èƒŒåç¯æŠ±ä½ä½ ï¼Œä¸‹å·´æŠµåœ¨ä½ è‚©å¤´ï¼Œå‘¼å¸å˜æœ‰ç‚¹é‡ï¼‰',
                    'ä½ ï¼ˆæ•…æ„è¹­åˆ°ä»–æ€€é‡Œï¼Œä»–æ„£äº†ä¸€ä¸‹éšå³æ‰£ç´§ä½ çš„è…°ï¼‰',
                    'ä½ ï¼ˆä¸€ä¸ªçœ¼ç¥ï¼Œä»–å°±è¯»æ‡‚å¹¶åŒ–è¢«åŠ¨ä¸ºä¸»åŠ¨ï¼‰'
                ]
            },
            {
                id: 3,
                text: `åœ¨"åƒè‹¹æœ"å¼€å§‹å‰ï¼Œä»–æœ€å–œæ¬¢äº²å»/æŠšæ‘¸ä½ èº«ä½“çš„å“ªä¸ªæ•æ„Ÿå¸¦ï¼Ÿ`,
                options: [
                    'é¼»å°–',
                    'åè…°å‡¹é™·çš„å¼§åº¦',
                    'é¢ˆçª/é”éª¨',
                    'è´è¶éª¨',
                    'ä½ è€³å/å˜´è¾¹/çœ¼ä¸‹é‚£é¢—å°ç—£'
                ]
            },
            {
                id: 4,
                text: `ä½ æœ€å–œæ¬¢ä»–èº«ä½“çš„å“ªä¸ªéƒ¨ä½åœ¨"åƒè‹¹æœ"æ—¶å±•ç°çš„æ€§æ„Ÿï¼Ÿ`,
                options: [
                    'ä»–æ»šåŠ¨çš„å–‰ç»“å’Œå‹æŠ‘çš„ä½å–˜',
                    'æ‰‹è‡‚ç»·èµ·çš„é’ç­‹å’Œçˆ†å‘çš„åŠ›é‡æ„Ÿ',
                    'åèƒŒç»·ç´§å¦‚å¼“å¼¦çš„å®Œç¾è‚Œè‚‰çº¿æ¡',
                    'æ±—ç æ»‘è¿‡ä»–é”éª¨ã€èƒ¸è‚Œçš„è½¨è¿¹',
                    'ä»–å¹³æ—¶å†·é™è‡ªæŒçš„çœ¼ç¥å½»åº•å¤±æ§'
                ]
            },
            {
                id: 5,
                text: 'å‰æˆæ—¶ï¼Œæœ€è®©ä½ å¿ƒè·³å¤±è¡¡çš„ä¸€ä¸ªæ ‡å¿—æ€§å°åŠ¨ä½œæ˜¯ä»€ä¹ˆï¼Ÿ',
                options: [
                    'æ…¢æ¡æ–¯ç†è§£å¼€ä½ ä¸€é¢—çº½æ‰£ï¼Œçœ¼ç¥é”ä½ä½ ',
                    'æŒ‡å°–è‹¥æœ‰ä¼¼æ— åœ°åˆ’è¿‡ä½ çš„è…°çº¿æˆ–å¤§è…¿å†…ä¾§ï¼Œå¼•èµ·æˆ˜æ —',
                    'çªç„¶æŠŠä½ æŠ±ä¸Šæ¡Œå­ä¸Šï¼Œä¸ä»–å¹³è§†ï¼ŒåŒæ‰‹æ’‘åœ¨ä½ ä¸¤ä¾§',
                    'ç”¨ä»–çš„é¢†å¸¦è½»è½»è’™ä½ä½ çš„çœ¼ç›ï¼Œå‰¥å¤ºè§†è§‰',
                    'æ§ä½ä½ çš„è„¸ï¼Œæ‹‡æŒ‡æ‘©æŒ²ä½ çš„ä¸‹å”‡ï¼Œçœ¼ç¥æ¸©æŸ”å¾—èƒ½æººæ­»äºº'
                ]
            },
            {
                id: 6,
                text: `ä»–"å“å°è‹¹æœ"æ—¶ï¼Œä»–æŒ‡å°–æœ€è¿·æ‹ä½ èº«ä½“çš„å“ªä¸€å¤„ï¼Ÿ`,
                options: [
                    'è…°ä¾§ç»†è…»çš„è‚Œè‚¤ï¼Œä»¿ä½›ä¸€ç”¨åŠ›å°±ä¼šç•™ä¸‹æŒ‡ç—•',
                    'èƒ¸å‰çš„æŸ”è½¯æ›²çº¿ï¼Œæ€»åƒæ§ç€æ˜“ç¢çš„çå®èˆ¬å°å¿ƒç¿¼ç¿¼',
                    'å¤§è…¿å†…ä¾§çš„ç»·ç´§ï¼Œåœ¨ä»–æŒä¸‹éšç€æ¯æ¬¡è§¦ç¢°è½»è½»é¢¤åŠ¨',
                    'è„ŠèƒŒå…‰æ»‘çš„æ›²çº¿ï¼Œä¸€è·¯å‘ä¸‹æ¢ç´¢éšç§˜çš„è…°çª',
                    'åé¢ˆï¼Œä»¿ä½›çŒ›å…½å¼ä½çŒç‰©è¦å®³'
                ]
            },
            {
                id: 7,
                text: `ä»–"å“å°è‹¹æœ"æ—¶ï¼Œä½ æœ€æ¸…æ™°åœ°æ„Ÿè§‰åˆ°ä»–å­˜åœ¨çš„ç¬é—´æ˜¯ï¼Ÿ`,
                options: [
                    'ä»–æ»šçƒ«çš„å‘¼å¸å¸¦ç€ä½å–˜ï¼Œé‡é‡å–·åœ¨ä½ æ•æ„Ÿçš„é¢ˆçª/è€³å',
                    'ä»–å¸¦ç€è–„èŒ§çš„æŒ‡è…¹ï¼ˆæˆ–å†°å‡‰çš„æˆ’æŒ‡/è…•è¡¨ï¼‰æ“¦è¿‡ä½ å¨‡å«©çš„è‚Œè‚¤',
                    'ä»–å®½åšçš„èº«ä½“å®Œå…¨è¦†ç›–ä½ ï¼Œå°†ä½ ç¦é”¢åœ¨ä»–çš„æ°”æ¯ä¸ä½“æ¸©ä¸­',
                    'ä»–å‘¢å–ƒç€ä½ çš„åå­—ï¼Œä»¥ä¸€ç§å®£å‘Šä¸»æƒçš„æ–¹å¼å½»åº•å æœ‰',
                    'ä»–çš„çœ¼çœ¸ä¸€ç¬ä¸ç¬åœ°ç›¯ç€ä½ ï¼Œæ•æ‰ä½ æ¯ä¸€ä¸ªç»†å¾®è¡¨æƒ…'
                ]
            },
            {
                id: 8,
                text: 'ä»–åœ¨æœ€æ²‰è¿·çš„æ—¶åˆ»ï¼Œä¼šå’¬ç€ä½ çš„è€³æœµï¼Œç”¨æ²™å“‘çš„å£°éŸ³è¯´å‡ºä»€ä¹ˆè¯ï¼Ÿ',
                options: [
                    '"è¿™é‡Œ......ä»é‡Œåˆ°å¤–éƒ½åˆ»ä¸Šæˆ‘çš„åå­—äº†ã€‚"',
                    '"æ ‡è®°äº†ï¼Œè·‘ä¸æ‰äº†ã€‚"',
                    '"å®è´ï¼Œä½ é‡Œé¢......æ¯”æˆ‘æƒ³è±¡çš„è¿˜è¦è´ªåƒã€‚"',
                    '"å¥½çˆ±ä½ ......æ€ä¹ˆçˆ±ä½ éƒ½ä¸å¤Ÿ......æŠ±ç´§æˆ‘ï¼Œåˆ«æ¾å¼€ã€‚"',
                    '"......ä¸è®¸çœ‹åˆ«äººï¼åªå‡†æƒ³ç€æˆ‘ï¼"'
                ]
            },
            {
                id: 9,
                text: 'ä»–æœ€å–œæ¬¢ä½ èº«ä½“ç»™å‡ºå“ªç§å›åº”ï¼Ÿ',
                options: [
                    'éš¾è€åœ°æ‰­åŠ¨è…°è‚¢ï¼Œæ— æ„è¯†å¯»æ±‚æ›´å¤š',
                    'æŒ‡å°–æ·±æ·±é™·å…¥ä»–åèƒŒï¼Œç•™ä¸‹æŠ“ç—•',
                    'å¸¦ç€å“­è…”çš„å‘œå’½å’Œç ´ç¢çš„æ±‚é¥¶',
                    'ä¸»åŠ¨è¿åˆçš„æ‘†åŠ¨å’Œçƒ­æƒ…çš„å›å»',
                    'æ— æ„è¯†åœ°ç”¨å°è…¿å‹¾ç¼ ä»–çš„è…°ï¼Œæˆ–æ˜¯ç”¨è„¸é¢Šè¹­ä»–æ±—æ¹¿çš„èƒ¸è†›'
                ]
            },
            {
                id: 10,
                text: `åœ¨éå§å®¤çš„åœ°ç‚¹ï¼Œ"åƒè‹¹æœ"æœ‰ä»€ä¹ˆç‹¬ç‰¹çš„åˆºæ¿€å’Œä¹è¶£ï¼Ÿ`,
                options: [
                    'æµ´å®¤ï¼šé•œä¸­äº¤å çš„èº«å½±ï¼Œæ°¤æ°²æ°´æ±½ä¸­æœ¦èƒ§çš„æ€§æ„Ÿ',
                    'ä¹¦æˆ¿ï¼šä¸¥è‚ƒåœºæ‰€çš„èƒŒå¾·æ„Ÿï¼Œçº¸å¼ å£°ã€çš®é©æ¤…çš„è§¦æ„Ÿ',
                    'è½¦ä¸Šï¼šç‹­å°ç©ºé—´ï¼Œéšæ—¶éšåœ°å¯èƒ½è¢«å‘ç°çš„éšç§˜å¿«æ„Ÿ',
                    'å¨æˆ¿ï¼šå†°å‡‰å²›å°ï¼Œç©¿ç€ä»–çš„è¡¬è¡«åšæ—©é¤ï¼Œæƒ¹ä»–æ‹¦è…°æŠ±ä¸Š',
                    'é˜³å°ï¼šå¤œé£ä¹ ä¹ ï¼ŒåŸå¸‚ç¯ç«ä¸ºèƒŒæ™¯çš„æµªæ¼«'
                ]
            },
            // ç»§ç»­æ·»åŠ å…¶ä»–15é“é¢˜...
            {
                id: 11,
                text: 'ä»–æœ‰æ²¡æœ‰åœ¨æŸä¸ªæ„æƒ³ä¸åˆ°ç”šè‡³æœ‰ç‚¹å±é™©çš„åœ°ç‚¹ï¼Œçªç„¶å¯¹ä½ äº§ç”Ÿ"åƒè‹¹æœ"çš„å¼ºçƒˆæ¬²æœ›ï¼Ÿ',
                options: [
                    'å…¬å¸èŒ¶æ°´é—´ï¼ˆå€Ÿå£æŠŠä½ æ‹‰è¿›éš”é—´ï¼‰',
                    'æœ‹å‹èšä¼šçš„é˜³å°ï¼ˆå€Ÿç€å¤œè‰²çš„æ©æŠ¤ï¼Œæ‰‹ä¸å®‰åˆ†åœ°æ¸¸èµ°ï¼‰',
                    'å®‰é™çš„å›¾ä¹¦é¦†è§’è½ï¼ˆå‹ä½å£°éŸ³åœ¨ä½ è€³è¾¹è¯´éœ²éª¨çš„è¯ï¼Œçœ‹ä½ è„¸çº¢ï¼‰',
                    'æ‹¥æŒ¤çš„ç”µæ¢¯é‡Œï¼ˆç”¨èº«ä½“æŠ¤ä½ä½ ï¼Œä½å¤´ç”¨ç¼çƒ­çš„çœ¼ç¥çœ‹ä½ ï¼‰',
                    'æœ‹å‹èšé¤çš„æ´—æ‰‹é—´å¤–ï¼ˆæŠŠä½ å µåœ¨æ‹è§’ç´¢å»ï¼‰'
                ]
            },
            {
                id: 12,
                text: 'ä»–æ˜¯å¦æ›¾ç‰¹åˆ«ç—´è¿·åœ°"æ ‡è®°"ä½ èº«ä½“çš„æŸä¸ªå¹³æ—¶ä¸è¢«æ³¨æ„çš„éƒ¨ä½ï¼Ÿ',
                options: [
                    'è„šè¸ï¼ˆå–œæ¬¢æ¡åœ¨æŒä¸­,ç•™ä¸‹å»ç—•ï¼‰',
                    'è€³å‚ï¼ˆåå¤å®å¸è½»å’¬ï¼Œè®©ä½ æµ‘èº«å‘è½¯ï¼‰',
                    'è…°çªï¼ˆæŒ‡å°–æµè¿å¿˜è¿”ï¼Œæ¬£èµå®ƒçš„ç¾å¦™å‡¹é™·ï¼‰',
                    'æ‰‹æŒ‡ï¼ˆä¸€æ ¹æ ¹äº²å»å®å¸ï¼Œæƒ…è‰²åˆè™”è¯šï¼‰',
                    'è†ç›–å†…ä¾§ï¼ˆå‘ç°è¿™é‡Œçš„å¼‚å¸¸æ•æ„Ÿï¼Œä¹æ­¤ä¸ç–²åœ°æ¢ç´¢ï¼‰'
                ]
            },
            {
                id: 13,
                text: `å“ªç§è¡£ç‰©/é…é¥°åœ¨"åƒè‹¹æœ"æ—¶æœ€èƒ½åˆºæ¿€åˆ°ä»–/ä½ ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰`,
                options: [
                    'ä½ ï¼šç©¿ç€ä»–çš„å®½å¤§è¡¬è¡«',
                    'ä½ ï¼šä»…æˆ´ç€é¡¹é“¾',
                    'ä½ ï¼šè•¾ä¸é•¿ç­’è¢œ',
                    'ä»–ï¼šæ¾å®çš„é¢†å¸¦',
                    'ä»–ï¼šè§£å¼€å‡ é¢—æ‰£å­çš„è¡¬è¡«'
                ],
                multiSelect: true
            },
            {
                id: 14,
                text: 'ä»–ä¼šåœ¨ä½ ä¸»åŠ¨æ—¶ï¼Œç”¨ä»€ä¹ˆè¯é¼“åŠ±ä½ ï¼Ÿ',
                options: [
                    '"å®è´ä»Šå¤©è¿™ä¹ˆä¹–ï¼Ÿä¸»åŠ¨çš„æ ·å­......çœŸè®©äººæŠŠæŒä¸ä½ã€‚"',
                    '"å®è´å¥½æ£’ï¼Œå¯¹ï¼å°±è¿™æ ·ï¼åˆ«åœ......"',
                    '"å­¦å¾—å¾ˆå¿«å˜›......çœ‹æ¥å¹³æ—¶æ²¡å°‘å·å­¦ï¼Ÿ"',
                    '"åˆ«ç´§å¼ ï¼Œæ…¢æ…¢æ¥ï¼Œæˆ‘åœ¨å‘¢......ä½ å¾ˆç¾ã€‚"',
                    '"......å“¼ï¼Œè¿™ä¸æ˜¯åšå¾—å¾ˆå¥½å˜›ï¼"'
                ]
            },
            {
                id: 15,
                text: 'æ¸©å­˜æ—¶ï¼Œä»–æœ€å–œæ¬¢ç”¨å“ªä¸ªéƒ¨ä½çœ·æ‹åœ°è¹­ä½ èº«ä½“å“ªä¸ªåœ°æ–¹ï¼Ÿ',
                options: [
                    'ç”¨é¼»å°–è¹­ä½ æ±—æ¹¿çš„é¬“è§’/é¢ˆçª',
                    'è„¸é¢Šè´´ç€ä½ å¹³å¦çš„å°è…¹/èƒ¸å£',
                    'å˜´å”‡æµè¿åœ¨ä½ è‚©å¤´/é”éª¨ï¼Œè½»å•„æµ…å»',
                    'é¢å¤´ç›¸æŠµï¼Œå‘¼å¸äº¤è',
                    'ç”¨ä¸‹å·´ä¸Šçš„èƒ¡èŒ¬è½»è½»ç£¨è¹­ä½ æ•æ„Ÿçš„è‚©é¢ˆ'
                ]
            },
            {
                id: 16,
                text: 'å½“ä»–çœ‹ç€ä½ å› ä»–è€Œç»½æ”¾çš„æ¨¡æ ·ï¼Œä»–å†…å¿ƒæ·±å¤„æœ€å¼ºçƒˆçš„å¿µå¤´æ˜¯ä»€ä¹ˆï¼Ÿ',
                options: [
                    '"å¥¹æ˜¯æˆ‘çš„ï¼Œä»å¤´åˆ°è„šï¼Œä»èº«åˆ°å¿ƒï¼Œæ°¸ç”Ÿæ°¸ä¸–ã€‚"',
                    '"æƒ³æŠŠå¥¹æ‰è¿›éª¨è¡€é‡Œï¼Œä¸€åˆ»ä¹Ÿä¸åˆ†ç¦»ã€‚"',
                    '"è¿™æ¨¡æ ·......ç»å¯¹ã€ç»å¯¹ä¸è®¸ç¬¬äºŒä¸ªäººçœ‹åˆ°ï¼"',
                    '"æ€ä¹ˆçˆ±å¥¹éƒ½çˆ±ä¸å¤Ÿ......æƒ³æŠŠå…¨ä¸–ç•Œéƒ½ç»™å¥¹ã€‚"',
                    '"æ˜¯æˆ‘è®©å¥¹å˜æˆè¿™æ ·çš„......åªæœ‰æˆ‘èƒ½åšåˆ°ã€‚"'
                ]
            },
            {
                id: 17,
                text: 'äº‹åæ¸…ç†æ—¶ï¼Œä»–å“ªä¸ªä¸ç»æ„çš„å°åŠ¨ä½œè®©ä½ è§‰å¾—ç‰¹åˆ«æ¸©æŸ”/æ€§æ„Ÿï¼Ÿ',
                options: [
                    'ç”¨æ¸©çƒ­çš„æ¹¿æ¯›å·¾ä»”ç»†æ“¦æ‹­ä½ æ¯ä¸€å¯¸è‚Œè‚¤ï¼ŒåŠ¨ä½œè½»æŸ”',
                    'å¸®ä½ æŠŠæ±—æ¹¿çš„ä¹±å‘æ¸©æŸ”åœ°åˆ«åˆ°è€³åï¼ŒæŒ‡å°–åˆ’è¿‡è€³å»“',
                    'æ¡èµ·æ•£è½ä¸€åœ°çš„è¡£ç‰©ï¼Œç”šè‡³ç¬¨æ‹™åœ°è¯•å›¾å¸®ä½ ç©¿ä¸Š',
                    'çªç„¶å°†ä½ æ‰“æ¨ªæŠ±èµ·ï¼Œå¾„ç›´èµ°å‘æµ´å®¤æ¸…ç†',
                    'æ¸…ç†æ—¶ï¼ŒæŒ‡å°–è‹¥æœ‰ä¼¼æ— åœ°æ»‘è¿‡æ•æ„Ÿå¸¦ï¼Œå¼•èµ·ä½ ç»†å¾®é¢¤æŠ–'
                ]
            },
            {
                id: 18,
                text: 'è¿™æ—¶ä½ å¬åˆ°ä»–çš„å¿ƒè·³å£°ï¼Œæ„Ÿè§‰å¦‚ä½•ï¼Ÿ',
                options: [
                    'æ²‰ç¨³æœ‰åŠ›ï¼Œåƒå®‰æŠšçš„é¼“ç‚¹ï¼Œè®©ä½ æ— æ¯”å®‰å¿ƒ',
                    'ä¾ç„¶å¿«é€Ÿé¼“åŠ¨ï¼Œä¸ä½ ç´Šä¹±çš„å¿ƒè·³åŒé¢‘ï¼Œä»–ä¹Ÿæœªå¹³å¤',
                    'å’Œè‡ªå·±çš„å¿ƒè·³æ¸æ¸åŒæ­¥ï¼Œä»¿ä½›èä¸ºä¸€ä½“',
                    'æ˜¯ä¸–ç•Œä¸Šæœ€åŠ¨å¬çš„å£°éŸ³ï¼Œä»–å› ä½ è€Œå­˜åœ¨',
                    'æ¯ä¸€ä¸‹éƒ½åœ¨è¯‰è¯´ç€çˆ±æ„ï¼Œæ¯”ä»»ä½•æƒ…è¯éƒ½åŠ¨äºº'
                ]
            },
            {
                id: 19,
                text: 'åœ¨ä½™éŸµä¸­ï¼Œä»–æ— æ„é—´æµéœ²å‡ºçš„å“ªä¸ªå°ç»†èŠ‚æœ€è®©ä½ å¿ƒåŠ¨ï¼Ÿ',
                options: [
                    'ä¸€å£°æ»¡è¶³çš„ã€æ‚ é•¿çš„å¹æ¯ï¼Œåƒå¸ä¸‹æ‰€æœ‰é‡æ‹…',
                    'æ— æ„è¯†åœ°æŠŠç©ä½ çš„ä¸€ç¼•å¤´å‘ï¼Œç»•åœ¨æŒ‡å°–',
                    'å°†ä½ æ›´ç´§åœ°æ‚å‘æ€€é‡Œï¼Œä¸‹å·´æŠµåœ¨ä½ å‘é¡¶ï¼Œä»¿ä½›æ€•ä½ æ¶ˆå¤±',
                    'é—­ç€çœ¼ï¼Œå˜´è§’å´å¸¦ç€ä¸€ä¸é¤è¶³çš„ã€è¿‘ä¹å­©å­æ°”çš„å¾®ç¬‘',
                    'æ·±æ·±æœ›ç€ä½ ï¼Œçœ¼ç¥é‡Œæœ‰æœªé€€çš„æƒ…æ½®å’Œæµ“å¾—åŒ–ä¸å¼€çš„çˆ±æ„'
                ]
            },
            {
                id: 20,
                text: 'ä»–ä¼šä¸ä¼šåœ¨äº‹åçªç„¶å˜å¾—å¾ˆ......ï¼Ÿ',
                options: [
                    'ç²˜äººï¼ˆåƒå¤§å‹çŠ¬ä¸€æ ·è´´ç€ä½ ï¼Œç´¢è¦äº²å»æ‹¥æŠ±ï¼‰',
                    'è¯ç—¨ï¼ˆçªç„¶å¼€å§‹è¯´å¾ˆå¤šæƒ…è¯æˆ–æœªæ¥ç•…æƒ³ï¼‰',
                    'å›°å€¦ï¼ˆå¾ˆå¿«æ²‰æ²‰ç¡å»ï¼Œæ‰‹è‡‚è¿˜ç´§ç´§åœˆç€ä½ ï¼‰',
                    'è‹¥æœ‰æ‰€æ€ï¼ˆå®‰é™åœ°çœ‹ç€ä½ ï¼Œçœ¼ç¥æ·±é‚ƒï¼‰',
                    'é‡æ–°ç‡ƒèµ·å°ç«è‹—ï¼ˆæ‰‹åˆå¼€å§‹ä¸å®‰åˆ†......ï¼‰'
                ]
            },
            {
                id: 21,
                text: 'æœ‰æ²¡æœ‰ä¸€ä¸ªç‰¹åˆ«çš„"åƒè‹¹æœ"åœ°ç‚¹ï¼Œå¯¹ä½ ä»¬æœ‰ç‰¹åˆ«çš„è±¡å¾æ„ä¹‰ï¼Ÿ',
                options: [
                    'åˆæ¬¡çš„åœ°ç‚¹',
                    'æŸä¸ªé‡è¦çš„çºªå¿µæ—¥/äº‹ä»¶åçš„åœºæ‰€',
                    'ä¸€ä¸ªæ›¾æœ‰è¿‡äº‰æ‰§æˆ–è¯¯ä¼šï¼Œæœ€ç»ˆåœ¨æ­¤å’Œè§£å¹¶æ›´äº²å¯†çš„åœ°æ–¹',
                    'ä¸€ä¸ªæ¡ä»¶è‰°è‹¦ä½†å¿ƒé å¾—æœ€è¿‘çš„åœ°æ–¹',
                    'ä»£è¡¨"å®¶"çš„åœ°æ–¹'
                ]
            },
            {
                id: 22,
                text: 'åœ¨"åƒè‹¹æœ"è¿™ä»¶äº‹ä¸Šï¼Œä»–ç»™è¿‡ä½ æœ€æ·±åˆ»çš„å®‰å…¨æ„Ÿ/è¢«çè§†æ„Ÿæ˜¯ä»€ä¹ˆï¼Ÿ',
                options: [
                    'æ— è®ºå¤šæ¿€åŠ¨ï¼Œå§‹ç»ˆå…³æ³¨ä½ çš„æ„Ÿå—å’Œååº”ï¼ŒåŠæ—¶è°ƒæ•´',
                    'äº‹å‰äº‹åçš„æ¸…æ´ã€ç…§é¡¾äº²åŠ›äº²ä¸º',
                    'æ˜ç¡®è¡¨ç¤ºå¹¶å°Šé‡ä½ çš„æ‰€æœ‰ç•Œé™å’Œ"å®‰å…¨è¯"',
                    'åœ¨äº²å¯†ä¸­/åï¼Œåå¤ç”¨è¨€è¯­å’Œè¡ŒåŠ¨ç¡®è®¤"çˆ±ä½ "ã€"ä½ æ˜¯å”¯ä¸€çš„"',
                    'åœ¨ä½ å¿ƒæƒ…ä¸ä½³/ä¸é€‚æ—¶ï¼Œèƒ½ç«‹åˆ»åœä¸‹å¹¶è½¬ä¸ºçº¯ç²¹çš„æ‹¥æŠ±å®‰æ…°'
                ]
            },
            {
                id: 23,
                text: 'ä½ è§‰å¾—"åƒè‹¹æœ"è¿™ä»¶äº‹ï¼Œå¯¹ä½ ä»¬çš„å…³ç³»æ„å‘³ç€ä»€ä¹ˆï¼Ÿ',
                options: [
                    'æœ€åŸå§‹ä¹Ÿæœ€æ·±åˆ»çš„çˆ±çš„è¯­è¨€',
                    'çµé­‚ä¸èº«ä½“çš„åŒé‡è”ç»“ï¼Œç¼ºä¸€ä¸å¯',
                    'ä»–å®£ç¤ºä¸»æƒå’Œç‹¬å çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯æˆ‘ç¡®è®¤å½’å±çš„æ–¹å¼',
                    'æ¢ç´¢å½¼æ­¤ã€è·å¾—æè‡´å¿«ä¹çš„ç§˜å¯†æ¸¸æˆ',
                    'ç–²æƒ«ä¸–ç•Œé‡Œå”¯ä¸€çš„é¿é£æ¸¯ï¼Œå¯ä»¥å……ç”µçš„åœ°æ–¹'
                ]
            },
            {
                id: 24,
                text: 'ç»å†è¿‡æ— æ•°æ¬¡"åƒè‹¹æœ"ï¼Œä½ ä»¬ä¹‹é—´æœ€çè´µçš„å˜åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ',
                options: [
                    'æ— è¨€çš„é»˜å¥‘ï¼Œä¸€ä¸ªçœ¼ç¥ã€ä¸€ä¸ªå‘¼å¸å°±çŸ¥é“å¯¹æ–¹æƒ³è¦ä»€ä¹ˆ',
                    'æè‡´çš„ä¿¡ä»»ï¼Œå°†èº«ä½“å’Œçµé­‚æœ€è„†å¼±çš„éƒ¨åˆ†å®Œå…¨äº¤ä»˜å¯¹æ–¹',
                    'æ— æ³•å‰²èˆçš„ç¾ç»Šï¼Œæ—©å·²è¶…è¶Šè‚‰ä½“æ¬¢æ„‰ï¼Œæˆä¸ºå½¼æ­¤ç”Ÿå‘½çš„ä¸€éƒ¨åˆ†',
                    'å…±åŒæ¢ç´¢çš„ä¹è¶£ï¼Œä¸æ–­å‘ç°æ–°çš„å¿«ä¹æ¨¡å¼å’Œå½¼æ­¤çš„æ•æ„Ÿç‚¹',
                    'ç»å¯¹çš„å®‰å¿ƒï¼ŒçŸ¥é“æ— è®ºä½•æ—¶ä½•åœ°ï¼Œå¯¹æ–¹éƒ½æ˜¯æœ€æ¸´æœ›å’Œæ¥çº³è‡ªå·±çš„äºº'
                ]
            },
            {
                id: 25,
                text: 'å¦‚æœä½ ä»¬çš„çˆ±æƒ…æœ‰ä¸€ç§ä¸“å±çš„"è‹¹æœé¦™æ°”"ï¼Œå®ƒä¼šæ˜¯ä»€ä¹ˆå‘³é“ï¼Ÿ',
                options: [
                    'çƒˆé…’æ··åˆæ¸…ç”œæœé¦™',
                    'é›ªæ¾ä¸æ¸©æš–çš„ç¥ç€',
                    'é›¨åé’è‰ä¸é˜³å…‰çš„å‘³é“',
                    'æµ“éƒçš„é»‘å·§å…‹åŠ›ä¸è¯±äººçº¢é…’é¦™',
                    'æµ·é£å’¸æ¶©ä¸é¦™æ©™çš„é…¸ç”œ'
                ]
            }
        ];

        // åˆ‡æ¢é¢„è§ˆæ¨¡å¼
        function togglePreview() {
            const preview = document.getElementById('preview-mode');
            preview.classList.toggle('hidden');
        }

        // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
        function showPage(page) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('[id$="-page"]').forEach(p => p.classList.add('hidden'));
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(page + '-page').classList.remove('hidden');
            currentPage = page;
            
            // å¦‚æœåˆ‡æ¢åˆ°é—®å·é¡µï¼Œæ˜¾ç¤ºå¤´åƒ
            if (page === 'quiz' && userAvatar) {
                document.getElementById('quiz-avatar-img').src = userAvatar;
                document.getElementById('quiz-avatar').classList.remove('hidden');
            }
        }

        // ä¸‹ä¸€é¡µ
        function nextPage() {
            if (currentPage === 'cover') {
                showPage('input');
            }
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    userAvatar = e.target.result;
                    // æ˜¾ç¤ºå¤´åƒ
                    const avatarImg = document.getElementById('uploaded-avatar');
                    avatarImg.src = userAvatar;
                    document.getElementById('avatar-area').classList.remove('hidden');
                    
                    checkInputComplete();
                };
                reader.readAsDataURL(file);
            }
        }

        // æ£€æŸ¥è¾“å…¥æ˜¯å¦å®Œæ•´
        function checkInputComplete() {
            const name = document.getElementById('userName').value.trim();
            const photo = userAvatar;
            const btn = document.getElementById('start-quiz-btn');
            
            if (name && photo) {
                btn.disabled = false;
                btn.classList.add('glow-effect');
            } else {
                btn.disabled = true;
                btn.classList.remove('glow-effect');
            }
        }

        // å¼€å§‹é—®å·
        function startQuiz() {
            userName = document.getElementById('userName').value.trim();
            showPage('quiz');
            displayQuestion(0);
        }

        // æ˜¾ç¤ºé—®é¢˜
        function displayQuestion(index) {
            if (index >= questions.length) {
                // é—®å·å®Œæˆï¼Œè·³è½¬åˆ°ç»“æœé¡µ
                generateLoveLetter();
                return;
            }

            currentQuestionIndex = index;
            const question = questions[index];
            
            // é‡ç½®å¤šé€‰çŠ¶æ€
            selectedOptions = [];
            
            // æ›´æ–°è¿›åº¦
            document.getElementById('current-question').textContent = index + 1;
            document.getElementById('progress-bar').style.width = ((index + 1) / questions.length * 100) + '%';
            
            // æ›´æ–°é—®é¢˜æ–‡æœ¬ï¼ŒåŠ¨æ€æ’å…¥å§“å
            let questionText = question.text.replace(/mjg/g, userName);
            
            // å¤„ç†"ä»–"çš„æ›¿æ¢ï¼šæ¯ä¸ªé—®é¢˜ç‹¬ç«‹è®¡ç®—ï¼Œç¬¬ä¸€æ¬¡å‡ºç°æ›¿æ¢ä¸ºç”¨æˆ·åï¼Œç¬¬äºŒæ¬¡ä¿æŒ"ä»–"
            const heRegex = /ä»–/g;
            let heCount = 0;
            questionText = questionText.replace(heRegex, (match) => {
                heCount++;
                return heCount === 1 ? userName : 'ä»–';
            });
            
            document.getElementById('question-text').textContent = questionText;
            
            // æ¸…ç©ºå¹¶é‡æ–°ç”Ÿæˆé€‰é¡¹
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, optionIndex) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'glass-card rounded-xl p-4 cursor-pointer hover:border-aurora/50 transition-all group';
                
                // å¤„ç†é€‰é¡¹æ–‡æœ¬ä¸­çš„æ‹¬å·å†…å®¹
                const formattedOption = formatOptionText(option);
                
                const checkboxType = question.multiSelect ? 'checkbox' : 'radio';
                
                optionDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-6 h-6 ${question.multiSelect ? 'rounded-md' : 'rounded-full'} border-2 border-white/30 flex-shrink-0 mt-1 group-hover:border-aurora transition-all flex items-center justify-center">
                            ${question.multiSelect ? '<div class="hidden w-3 h-3 bg-aurora rounded-sm"></div>' : ''}
                        </div>
                        <div class="text-gray-200 group-hover:text-white transition-all font-serif">${formattedOption}</div>
                    </div>
                `;
                
                if (question.multiSelect) {
                    optionDiv.onclick = () => toggleMultiOption(optionIndex, option, optionDiv);
                } else {
                    optionDiv.onclick = () => selectOption(optionIndex, option, optionDiv);
                }
                
                optionsContainer.appendChild(optionDiv);
            });
            
            // å¦‚æœæ˜¯å¤šé€‰é¢˜ï¼Œæ·»åŠ ç¡®è®¤æŒ‰é’®
            if (question.multiSelect) {
                const confirmDiv = document.createElement('div');
                confirmDiv.innerHTML = `
                    <button 
                        id="confirm-multi-btn"
                        onclick="confirmMultiSelection()"
                        class="w-full mt-4 glass-button text-white py-3 rounded-xl font-medium hover:scale-[1.02] transition-all opacity-50 cursor-not-allowed font-serif"
                        disabled
                    >
                        ç¡®è®¤é€‰æ‹©
                    </button>
                `;
                optionsContainer.appendChild(confirmDiv);
            }
            
            // æ¸…ç©ºè‡ªå®šä¹‰ç­”æ¡ˆå’Œéšè—ä¸‹ä¸€é¢˜æŒ‰é’®
            document.getElementById('custom-answer').value = '';
            document.getElementById('next-question-btn').classList.add('hidden');
        }

        // å¤šé€‰é¢˜é€‰é¡¹åˆ‡æ¢
        function toggleMultiOption(index, text, element) {
            const checkbox = element.querySelector('.w-6 > div');
            const isSelected = selectedOptions.includes(index);
            
            if (isSelected) {
                // å–æ¶ˆé€‰æ‹©
                selectedOptions = selectedOptions.filter(i => i !== index);
                element.classList.remove('bg-aurora/20', 'border-aurora');
                checkbox.classList.add('hidden');
            } else {
                // æ·»åŠ é€‰æ‹©
                selectedOptions.push(index);
                element.classList.add('bg-aurora/20', 'border-aurora');
                checkbox.classList.remove('hidden');
            }
            
            // æ›´æ–°ç¡®è®¤æŒ‰é’®çŠ¶æ€
            const confirmBtn = document.getElementById('confirm-multi-btn');
            if (selectedOptions.length > 0) {
                confirmBtn.disabled = false;
                confirmBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                confirmBtn.classList.add('glow-effect');
            } else {
                confirmBtn.disabled = true;
                confirmBtn.classList.add('opacity-50', 'cursor-not-allowed');
                confirmBtn.classList.remove('glow-effect');
            }
        }

        // ç¡®è®¤å¤šé€‰ç­”æ¡ˆ
        function confirmMultiSelection() {
            const question = questions[currentQuestionIndex];
            const selectedTexts = selectedOptions.map(index => question.options[index]);
            const customAnswer = document.getElementById('custom-answer').value.trim();
            
            quizAnswers[currentQuestionIndex] = {
                questionId: question.id,
                selectedOption: selectedTexts,
                customAnswer: customAnswer,
                questionText: question.text,
                multiSelect: true
            };
            
            // è·³è½¬åˆ°ä¸‹ä¸€é¢˜
            setTimeout(() => {
                displayQuestion(currentQuestionIndex + 1);
            }, 500);
        }

        // æ ¼å¼åŒ–é€‰é¡¹æ–‡æœ¬ï¼Œå¤„ç†æ‹¬å·å†…å®¹
        function formatOptionText(text) {
            return text.replace(/ï¼ˆ([^ï¼‰]*)ï¼‰/g, '<span class="text-sm text-gray-400 font-light">ï¼ˆ$1ï¼‰</span>');
        }

        // åˆ‡æ¢ä¸‹ä¸€é¢˜æŒ‰é’®æ˜¾ç¤º
        function toggleNextButton() {
            const customAnswer = document.getElementById('custom-answer').value.trim();
            const nextBtn = document.getElementById('next-question-btn');
            
            if (customAnswer) {
                nextBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.add('hidden');
            }
        }

        // ä»è‡ªå®šä¹‰ç­”æ¡ˆè¿›å…¥ä¸‹ä¸€é¢˜
        function nextQuestionFromCustom() {
            const customAnswer = document.getElementById('custom-answer').value.trim();
            const question = questions[currentQuestionIndex];
            
            // ä¿å­˜è‡ªå®šä¹‰ç­”æ¡ˆ
            quizAnswers[currentQuestionIndex] = {
                questionId: question.id,
                selectedOption: question.multiSelect ? selectedOptions.map(index => question.options[index]) : null,
                customAnswer: customAnswer,
                questionText: question.text,
                multiSelect: question.multiSelect || false
            };
            
            // è·³è½¬åˆ°ä¸‹ä¸€é¢˜
            displayQuestion(currentQuestionIndex + 1);
        }

        // é€‰æ‹©é€‰é¡¹ï¼ˆå•é€‰é¢˜ï¼‰
        function selectOption(index, text, element) {
            const question = questions[currentQuestionIndex];
            
            // å¦‚æœæ˜¯å¤šé€‰é¢˜ï¼Œä¸å¤„ç†
            if (question.multiSelect) return;
            
            // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('#options-container > div:not(:last-child)').forEach(div => {
                div.classList.remove('bg-aurora/20', 'border-aurora');
                div.querySelector('.w-6').classList.remove('bg-aurora');
            });
            
            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            element.classList.add('bg-aurora/20', 'border-aurora');
            element.querySelector('.w-6').classList.add('bg-aurora');
            
            // ä¿å­˜ç­”æ¡ˆ
            const customAnswer = document.getElementById('custom-answer').value.trim();
            quizAnswers[currentQuestionIndex] = {
                questionId: question.id,
                selectedOption: text,
                customAnswer: customAnswer,
                questionText: question.text
            };
            
            // éšè—ä¸‹ä¸€é¢˜æŒ‰é’®ï¼ˆå› ä¸ºé€‰æ‹©äº†é€‰é¡¹ä¼šè‡ªåŠ¨è·³è½¬ï¼‰
            document.getElementById('next-question-btn').classList.add('hidden');
            
            // å»¶è¿Ÿè·³è½¬åˆ°ä¸‹ä¸€é¢˜
            setTimeout(() => {
                displayQuestion(currentQuestionIndex + 1);
            }, 800);
        }

        // éŸ³ä¹æ§åˆ¶
        function toggleMusic() {
            const audio = document.getElementById('background-music');
            const icon = document.getElementById('music-icon');
            
            if (isPlaying) {
                audio.pause();
                icon.textContent = 'ğŸµ';
                isPlaying = false;
            } else {
                playBackgroundMusic();
            }
        }

        function playBackgroundMusic() {
            const audio = document.getElementById('background-music');
            const icon = document.getElementById('music-icon');
            
            // ç”±äºæµè§ˆå™¨é™åˆ¶ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾
            audio.play().then(() => {
                isPlaying = true;
                icon.textContent = 'ğŸ¶';
            }).catch((error) => {
                console.log('éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢:', error);
                icon.textContent = 'ğŸ”‡';
            });
        }

        // ç”Ÿæˆæƒ…ä¹¦
        function generateLoveLetter() {
            showPage('result');
            
            // è®¾ç½®å¤´åƒå’Œå§“å
            document.getElementById('result-avatar').src = userAvatar;
            document.getElementById('result-name').textContent = userName;
            
            // æå–å›¾ç‰‡ä¸»è‰²è°ƒå¹¶åº”ç”¨èƒŒæ™¯
            if (userAvatar) {
                extractDominantColorAndApplyBackground(userAvatar);
            }
            
            // ç”Ÿæˆæƒ…ä¹¦å†…å®¹
            createLoveLetterContent();
        }

        // æå–å›¾ç‰‡ä¸»è‰²è°ƒå¹¶åº”ç”¨èƒŒæ™¯
        function extractDominantColorAndApplyBackground(imageSrc) {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = function() {
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // è®¾ç½®canvaså¤§å°
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // ç»˜åˆ¶å›¾åƒ
                    ctx.drawImage(img, 0, 0);
                    
                    // è·å–å›¾åƒæ•°æ®
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    
                    // è®¡ç®—ä¸»è‰²è°ƒ
                    const colorCount = {};
                    const step = 20; // é‡‡æ ·æ­¥é•¿ï¼Œæé«˜æ€§èƒ½
                    
                    for (let i = 0; i < data.length; i += step * 4) {
                        const r = Math.round(data[i] / 32) * 32;
                        const g = Math.round(data[i + 1] / 32) * 32;
                        const b = Math.round(data[i + 2] / 32) * 32;
                        const alpha = data[i + 3];
                        
                        if (alpha > 125) { // å¿½ç•¥é€æ˜åƒç´ 
                            const color = `${r},${g},${b}`;
                            colorCount[color] = (colorCount[color] || 0) + 1;
                        }
                    }
                    
                    // æ‰¾å‡ºæœ€å¸¸è§çš„é¢œè‰²
                    let dominantColor = '233,30,99'; // é»˜è®¤auroraè‰²
                    let maxCount = 0;
                    
                    for (const color in colorCount) {
                        if (colorCount[color] > maxCount) {
                            maxCount = colorCount[color];
                            dominantColor = color;
                        }
                    }
                    
                    // åº”ç”¨åˆ°èƒŒæ™¯
                    applyDynamicBackground(dominantColor);
                    
                } catch (error) {
                    console.log('é¢œè‰²æå–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è‰²å½©:', error);
                    applyDynamicBackground('233,30,99'); // ä½¿ç”¨é»˜è®¤auroraè‰²
                }
            };
            
            img.onerror = function() {
                console.log('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è‰²å½©');
                applyDynamicBackground('233,30,99');
            };
            
            img.src = imageSrc;
        }

        // åº”ç”¨åŠ¨æ€èƒŒæ™¯è‰²
        function applyDynamicBackground(rgbColor) {
            const dynamicBg = document.getElementById('dynamic-bg');
            if (dynamicBg) {
                // åˆ›å»ºåŸºäºä¸»è‰²è°ƒçš„æ¸å˜
                const gradient = `linear-gradient(135deg, 
                    rgba(${rgbColor}, 0.3) 0%, 
                    rgba(${rgbColor}, 0.1) 50%, 
                    rgba(${rgbColor}, 0.2) 100%)`;
                
                dynamicBg.style.background = gradient;
                
                // åŒæ—¶æ›´æ–°é¡µé¢æ•´ä½“èƒŒæ™¯
                const resultPage = document.getElementById('result-page');
                resultPage.style.background = `radial-gradient(ellipse at center, rgba(${rgbColor}, 0.1) 0%, rgba(26, 26, 46, 0.9) 100%)`;
            }
        }

        // åˆ›å»ºæƒ…ä¹¦å†…å®¹
        function createLoveLetterContent() {
            // è¿‡æ»¤æœ‰æ•ˆç­”æ¡ˆï¼ˆæœ‰é€‰æ‹©æˆ–è‡ªå®šä¹‰å›ç­”çš„ï¼‰
            const validAnswers = quizAnswers.filter(answer => 
                (answer.selectedOption && answer.selectedOption.length > 0) || 
                (answer.customAnswer && answer.customAnswer.trim())
            );
            
            // éšæœºé€‰æ‹©3ä¸ªé—®ç­”
            const selectedAnswers = getRandomItems(validAnswers, 3);
            
            // ç”Ÿæˆæƒ…ä¹¦æ®µè½
            const letterContent = document.getElementById('love-letter-content');
            letterContent.innerHTML = '';
            
            selectedAnswers.forEach((answer, index) => {
                const paragraph = createLoveLetterParagraph(answer, index);
                letterContent.appendChild(paragraph);
            });
        }

        // åˆ›å»ºæƒ…ä¹¦æ®µè½
        function createLoveLetterParagraph(answer, index) {
            const div = document.createElement('div');
            div.className = 'relative group mb-6';
            
            // ä¸»å†…å®¹å®¹å™¨ - ç»ç’ƒæ‹Ÿæ€æ–¹æ¡†
            const contentBox = document.createElement('div');
            contentBox.className = 'relative backdrop-blur-xl bg-white/5 border border-white/10 rounded-2xl p-6 shadow-2xl';
            
            // å€’å½±æ•ˆæœ
            const reflection = document.createElement('div');
            reflection.className = 'absolute top-full left-0 right-0 h-full backdrop-blur-xl bg-white/2 border border-white/5 rounded-2xl opacity-30 transform scale-y-[-1] translate-y-2 pointer-events-none';
            reflection.style.maskImage = 'linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, transparent 70%)';
            reflection.style.webkitMaskImage = 'linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, transparent 70%)';
            
            // è½¬æ¢é—®é¢˜ä¸ºæƒ…ä¹¦è¯­å¥
            let letterText = '';
            const questionText = answer.questionText.replace(/mjg/g, userName);
            
            // ä½¿ç”¨è‡ªå®šä¹‰ç­”æ¡ˆä¼˜å…ˆï¼Œå¦åˆ™ä½¿ç”¨é€‰é¡¹
            const userResponse = answer.customAnswer && answer.customAnswer.trim() 
                ? answer.customAnswer 
                : (Array.isArray(answer.selectedOption) 
                    ? answer.selectedOption.join('ï¼Œ') 
                    : answer.selectedOption);
            
            if (userResponse) {
                letterText = convertToLoveLetter(questionText, userResponse, userName);
                // å°†æƒ…ä¹¦å†…å®¹ä¸­çš„"ä»–"æ›¿æ¢ä¸ºç”¨æˆ·åå­—
                letterText = letterText.replace(/ä»–/g, userName);
            }
            
            contentBox.innerHTML = `
                <div class="flex items-center space-x-2 mb-4">
                    <div class="w-6 h-6 rounded-full bg-gradient-to-r from-pink-400/60 to-rose-400/60 flex items-center justify-center shadow-sm backdrop-blur-sm">
                        <span class="text-white text-xs font-bold">${index + 1}</span>
                    </div>
                    <p class="text-gray-400 italic text-xs font-serif opacity-80">ç¬¬${index + 1}ç« </p>
                </div>
                <p class="text-gray-100 leading-relaxed text-base font-serif group-hover:text-white transition-colors duration-300">${letterText}</p>
            `;
            
            // ç»„è£…å…ƒç´ 
            div.appendChild(contentBox);
            div.appendChild(reflection);
            
            return div;
        }

        // å°†é—®ç­”è½¬æ¢ä¸ºæƒ…ä¹¦è¯­å¥
        function convertToLoveLetter(question, answer, name) {
            // ç§»é™¤é—®å·å’Œç–‘é—®è¯ï¼Œç„¶åè¿æ¥ç­”æ¡ˆ
            let processedQuestion = question
                .replace(/[ï¼Ÿ?]/g, '') // ç§»é™¤é—®å·
                .replace(/æ˜¯å¦/g, '') // ç§»é™¤"æ˜¯å¦"
                .replace(/ä»€ä¹ˆ\w*/g, '') // ç§»é™¤"ä»€ä¹ˆXXX"ç–‘é—®è¯
                .replace(/å“ªä¸ª\w*/g, '') // ç§»é™¤"å“ªä¸ªXXX"ç–‘é—®è¯
                .replace(/å“ªç§\w*/g, '') // ç§»é™¤"å“ªç§XXX"ç–‘é—®è¯
                .replace(/å“ªé‡Œ\w*/g, '') // ç§»é™¤"å“ªé‡ŒXXX"ç–‘é—®è¯
                .replace(/æ€ä¹ˆ\w*/g, '') // ç§»é™¤"æ€ä¹ˆXXX"ç–‘é—®è¯
                .replace(/å¦‚ä½•\w*/g, '') // ç§»é™¤"å¦‚ä½•XXX"ç–‘é—®è¯
                .replace(/æ—¶$/g, '') // ç§»é™¤ç»“å°¾çš„"æ—¶"
                .replace(/å—$/g, '') // ç§»é™¤ç»“å°¾çš„"å—"
                .replace(/å‘¢$/g, '') // ç§»é™¤ç»“å°¾çš„"å‘¢"
                .trim();
            
            // æ ¹æ®é—®é¢˜ç±»å‹æ·»åŠ é€»è¾‘è¯"æ˜¯"
            
            // å¦‚æœé—®é¢˜ä»¥"å½“"å¼€å¤´ï¼Œä¿æŒè¿™ç§è¡¨è¿°ï¼Œå¹¶åŠ å…¥"æ˜¯"
            if (processedQuestion.startsWith('å½“')) {
                return `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
            }
            
            // å¦‚æœé—®é¢˜ä»¥"æœ‰æ²¡æœ‰"å¼€å¤´ï¼Œè½¬æ¢ä¸ºé™ˆè¿°å¥
            if (processedQuestion.startsWith('æœ‰æ²¡æœ‰')) {
                processedQuestion = processedQuestion.replace('æœ‰æ²¡æœ‰', '');
                return `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
            }
            
            // å¦‚æœé—®é¢˜ä»¥"ä½ è§‰å¾—"å¼€å¤´ï¼Œè½¬æ¢ä¸ºé™ˆè¿°å¥
            if (processedQuestion.startsWith('ä½ è§‰å¾—')) {
                processedQuestion = processedQuestion.replace('ä½ è§‰å¾—', '');
                return `å…³äº${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
            }
            
            // å¦‚æœé—®é¢˜ä»¥"åœ¨"å¼€å¤´ï¼ˆæ¯”å¦‚"åœ¨ä½™éŸµä¸­"ï¼‰ï¼Œä¿æŒè¡¨è¿°å¹¶åŠ å…¥"æ˜¯"
            if (processedQuestion.startsWith('åœ¨')) {
                return `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
            }
            
            // å¤„ç†åŒ…å«"æœ€"çš„é—®é¢˜
            if (processedQuestion.includes('æœ€')) {
                return `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
            }
            
            // å¤„ç†"ä»–ä¼šä¸ä¼š"ç±»å‹çš„é—®é¢˜
            if (processedQuestion.includes('ä¼šä¸ä¼š')) {
                processedQuestion = processedQuestion.replace('ä¼šä¸ä¼š', 'ä¼š');
                return `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
            }
            
            // å¤„ç†å…¶ä»–ç–‘é—®å¥è½¬é™ˆè¿°å¥
            if (processedQuestion.includes('æ˜¯è°') || processedQuestion.includes('è°')) {
                processedQuestion = processedQuestion.replace(/æ˜¯è°|è°/g, '');
                return `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
            }
            
            // å¤„ç†åœ°ç‚¹ã€æ„Ÿå—ç­‰ç±»å‹çš„é—®é¢˜ï¼Œç›´æ¥åŠ å…¥"æ˜¯"
            if (processedQuestion.includes('åœ°ç‚¹') || processedQuestion.includes('æ„Ÿè§‰') || processedQuestion.includes('ç¬é—´') || processedQuestion.includes('éƒ¨ä½')) {
                return `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
            }
            
            // é»˜è®¤æ ¼å¼ï¼ŒåŠ å…¥"æ˜¯"å¢åŠ é€»è¾‘æ€§
            return `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`;
        }

        // éšæœºé€‰æ‹©æ•°ç»„ä¸­çš„é¡¹ç›®
        function getRandomItems(array, count) {
            const shuffled = array.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.min(count, array.length));
        }

        // é‡æ–°ç”Ÿæˆæƒ…ä¹¦
        function generateNewLetter() {
            createLoveLetterContent();
            // é‡æ–°åº”ç”¨é¢œè‰²èƒŒæ™¯
            if (userAvatar) {
                extractDominantColorAndApplyBackground(userAvatar);
            }
        }

        // é‡æ–°å¼€å§‹é—®å·
        function restartQuiz() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿè¿™ä¼šæ¸…ç©ºå½“å‰çš„æ‰€æœ‰ç­”æ¡ˆã€‚')) {
                // é‡ç½®æ‰€æœ‰æ•°æ®
                userName = '';
                userAvatar = '';
                quizAnswers = [];
                currentQuestionIndex = 0;
                selectedOptions = [];
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('userName').value = '';
                document.getElementById('userPhoto').value = '';
                document.getElementById('avatar-area').classList.add('hidden');
                document.getElementById('quiz-avatar').classList.add('hidden');
                
                // è¿”å›è¾“å…¥é¡µ
                showPage('input');
            }
        }

        // ç›‘å¬å§“åè¾“å…¥
        document.getElementById('userName').addEventListener('input', checkInputComplete);

        // åˆå§‹åŒ–åŠ¨ç”»
        function initAnimations() {
            setInterval(() => {
                // é‡æ–°å¯åŠ¨é£˜è½åŠ¨ç”»ï¼Œåªæœ‰çˆ±å¿ƒå’Œæ¨±èŠ±
                const hearts = ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’'];
                const flowers = ['ğŸŒ¸'];
                const allElements = [...hearts, ...flowers];
                const colors = ['text-aurora', 'text-rose-glow', 'text-pink-dream', 'text-pink-300', 'text-pink-200'];
                const positions = ['5%', '15%', '25%', '35%', '45%', '55%', '65%', '75%', '85%', '95%'];
                
                const randomElement = allElements[Math.floor(Math.random() * allElements.length)];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                const randomPos = positions[Math.floor(Math.random() * positions.length)];
                const randomSize = ['text-lg', 'text-xl'][Math.floor(Math.random() * 2)];
                const randomDelay = Math.random() * 2;
                const randomOpacity = ['opacity-40', 'opacity-50', 'opacity-60', 'opacity-70'][Math.floor(Math.random() * 4)];
                
                const element = document.createElement('div');
                element.className = `absolute top-0 ${randomColor} ${randomSize} falling pointer-events-none ${randomOpacity}`;
                element.style.left = randomPos;
                element.style.animationDelay = randomDelay + 's';
                element.textContent = randomElement;
                
                document.getElementById('animation-bg').appendChild(element);
                
                // æ¸…ç†æ—§å…ƒç´ 
                setTimeout(() => {
                    if (element.parentNode) {
                        element.parentNode.removeChild(element);
                    }
                }, 10000);
            }, 5000); // å‡å°‘ç”Ÿæˆé¢‘ç‡ï¼Œé¿å…è¿‡å¤š
        }

        // å¯åŠ¨åŠ¨ç”»
        initAnimations();
    </script>
</body>
</html>